---
title: Disaggregate analyses
author: Curt, 3/08/2017, Hannah, 4/4/2017
output:
  html_document:
    highlight: pygments
    theme: cerulean
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(dplyr)
require(lme4)
require(lmerTest)
require(ggplot2)
#setwd("C:/Users/Curt/Box Sync/Bruce Projects/Sequential Processing/PointByPoint Processing/Created by R_ArtRej")
MeanCent_dat = read.delim("N2prev_FSWprev_MeanCent_EventFixed.txt" )
MeanCent_dat$RT[MeanCent_dat$RT == -7] = NA

MeanCent_dat$Trial.scaled = (MeanCent_dat$Trial-1)/100
```
**Major changes: Reknitted with new data (trials fixed for subs 2, 4, 8, 16, 17, 19, 30, 59, 70, 72). Doesn't include 19, 74, or 137 because of difficulty matching up RT and ERP data. **

**Sample includes 33 subjects.**  

The subject mean and subject mean centered variables have been computed for SlowWavePrev.

A datapoint will be included if:  

1) Current trial is not rejected due to artifacts.  
2) Current trial is not the first trial of the block (i.e. trial 1, 101, 201, 301 etc. are not included).  
3) Both current trial and previous trial are correct.
4) Previous trial has not been rejecred due to artifacts.

SlowWaveMean indicates the between-subject effect.  
SlowWaveCent indicates the within-subject effect.  

### 1. SW on one trial predicting N2 on the following trial
```{r data1}
Dis_N2_Out = lmer(N2curr ~ SlowWaveMean + SlowWaveCent +
                    (1|Subject), data = MeanCent_dat)
```

**Random effects:**  
``` {r grand1random, echo = FALSE}
summary(Dis_N2_Out)$varcor
```

**Fixed effects:**
``` {r grand1fixed, echo = FALSE} 
est = as.data.frame(round(summary(Dis_N2_Out)$coefficients, digits = 3))
est
```



#### A. SW on one trial predicting N2 on the following trial, including trial as a predictor
```{r Adata1}
Dis_N2_Out = lmer(N2curr ~ SlowWaveMean + SlowWaveCent*Trial.scaled +
                    (1|Subject), data = MeanCent_dat)
```

**Random effects:**  
``` {r Agrand1random, echo = FALSE}
summary(Dis_N2_Out)$varcor
```

**Fixed effects:**
``` {r Agrand1fixed, echo = FALSE} 
est = as.data.frame(round(summary(Dis_N2_Out)$coefficients, digits = 3))
est
```



### 2. SlowWave on one trial predicting RT on the following trial
```{r data2}
Dis_RT_Out = lmer(RT ~ SlowWaveMean + SlowWaveCent + 
                    (1|Subject), data = MeanCent_dat)
```
  
**Random effects:**  
``` {r grand2random, echo = FALSE}
summary(Dis_RT_Out)$varcor
```

**Fixed effects:**
``` {r grand2fixed, echo = FALSE} 
est = as.data.frame(round(summary(Dis_RT_Out)$coefficients, digits = 3))
est
```



#### B. SW on one trial predicting RT on the following trial, including trial as a predictor
```{r Bdata1}
Dis_N2_Out = lmer(RT ~ SlowWaveMean + SlowWaveCent*Trial.scaled +
                    (1|Subject), data = MeanCent_dat)
```

**Random effects:**  
``` {r Bgrand1random, echo = FALSE}
summary(Dis_N2_Out)$varcor
```

**Beginning of experiment:**
``` {r Bgrand1fixed, echo = FALSE} 
est1 = as.data.frame(round(summary(Dis_N2_Out)$coefficients, digits = 3))
est1
```

```{r Bdata2, echo=F}
# fit two more models to test interaction at middle and end of experiment

MeanCent_dat$Trial.mid = MeanCent_dat$Trial.scaled - 4
MeanCent_dat$Trial.end = MeanCent_dat$Trial.scaled - 8

Dis_N2_Out.mid = lmer(RT ~ SlowWaveMean + SlowWaveCent*Trial.mid +
                    (1|Subject), data = MeanCent_dat)
Dis_N2_Out.end = lmer(RT ~ SlowWaveMean + SlowWaveCent*Trial.end +
                    (1|Subject), data = MeanCent_dat)

```


  
**Middle of experiment:**
``` {r Bgrand1fixed2, echo = FALSE} 
est2 = as.data.frame(round(summary(Dis_N2_Out.mid)$coefficients, digits = 3))
est2
```

**End of experiment:**
``` {r Bgrand1fixed3, echo = FALSE} 
est3 = as.data.frame(round(summary(Dis_N2_Out.end)$coefficients, digits = 3))
est3
```


```{r plotinteraction, echo=FALSE, warning = FALSE}

forplotting = data.frame(intercept = est1[1,1], slope = est1[3,1], line = "beginning") %>% 
  rbind(data.frame(intercept = est2[1,1], slope = est2[3,1], line = "middle")) %>% 
  rbind(data.frame(intercept = est3[1,1], slope = est3[3,1], line = "end"))


ggplot(MeanCent_dat, aes(x=SlowWaveCent, y=RT)) +
  geom_abline(data = forplotting, aes(intercept = forplotting[2,1], slope=forplotting[1,2], color = "Beginning"), size=1) +
  geom_abline(data = forplotting, aes(intercept = forplotting[2,1], slope=forplotting[2,2],color = "Middle"), size=1) +
  geom_abline(data = forplotting, aes(intercept = forplotting[2,1], slope=forplotting[3,2], color = "End"), size=1) + 
  theme_bw() +
  scale_colour_manual("", 
                      values = c("Beginning"="lightblue", "Middle"="blue", 
                                 "End"="darkblue")) +
#  geom_hline(yintercept=0) +
  geom_vline(xintercept=0) +
  labs(x = "SlowWave on Trial N - 1 (uV)", y = "RT on Trial N (ms)") +
  ylim(421, 423) +
#  ggtitle("Probing the interaction") +
  theme(plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size=20),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        legend.text = element_text(size=16))

ggsave("./Figures/Figure5.tiff", width= 8, height= 7)

```


### 3. N2 on one trial predicting N2 on the following trial

```{r data3}
Dis_N2_Out = lmer(N2curr ~ N2Mean + N2Cent + 
                    (1|Subject), data = MeanCent_dat)
```
  
**Random effects:**  
``` {r grand3random, echo = FALSE}
summary(Dis_N2_Out)$varcor
```

**Fixed effects:**
``` {r grand3fixed, echo = FALSE} 
est = as.data.frame(round(summary(Dis_N2_Out)$coefficients, digits = 3))
est
```


#### C. N2 on one trial predicting N2 on the following trial, including trial as a predictor
```{r Cdata1}
Dis_N2_Out2 = lmer(N2curr ~ N2Mean + N2Cent*Trial.scaled + 
                    (1|Subject), data = MeanCent_dat)
```

**Random effects:**  
``` {r Cgrand1random, echo = FALSE}
summary(Dis_N2_Out2)$varcor
```

**Fixed effects:**
``` {r Cgrand1fixed, echo = FALSE} 
est = as.data.frame(round(summary(Dis_N2_Out2)$coefficients, digits = 3))
est
```


### 4. SW on one trial predicting SW on the following trial

```{r data4}
Dis_SW_Out = lmer(SlowWaveCurr ~ SlowWaveMean + SlowWaveCent + 
                    (1|Subject), data = MeanCent_dat)
```
  
**Random effects:**  
``` {r grand4random, echo = FALSE}
summary(Dis_SW_Out)$varcor
```

**Fixed effects:**
``` {r grand4fixed, echo = FALSE} 
est = as.data.frame(round(summary(Dis_SW_Out)$coefficients, digits = 3))
est
```


#### D. SW on one trial predicting SW on the following trial, including trial as a predictor
```{r Ddata1}
Dis_SW_Out2 = lmer(SlowWaveCurr ~ SlowWaveMean + SlowWaveCent*Trial.scaled + 
                    (1|Subject), data = MeanCent_dat)
```

**Random effects:**  
``` {r Dgrand1random, echo = FALSE}
summary(Dis_SW_Out2)$varcor
```

**Fixed effects:**
``` {r Dgrand1fixed, echo = FALSE} 
est = as.data.frame(round(summary(Dis_SW_Out2)$coefficients, digits = 3))
est
```
